<Page x:Class="app.DESCKTOP.Views.Dashboard.DashboardPage"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:app.DESCKTOP.Views.Dashboard"
      mc:Ignorable="d" 
      Title="DashboardPage"
      Background="{StaticResource PageBackground}">
    <Page.Resources>
        <!-- Небольшая кнопка-ссылка как в макете (аккуратно и без акцента). -->
        <Style x:Key="TileLinkButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#6B7280"/>
            <Setter Property="FontSize" Value="11"/>
            <Setter Property="Padding" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
        </Style>
    </Page.Resources>
    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <StackPanel Grid.Row="0" Margin="0,0,0,12">
            <TextBlock Text="Личный кабинет. Главная" FontSize="18" FontWeight="SemiBold"/>
            <DockPanel Margin="0,4,0,0">
                <TextBlock Text="Личный кабинет" FontSize="12" Foreground="Gray"/>
                <Button Content="Показать все плитки" Style="{StaticResource TileLinkButtonStyle}" DockPanel.Dock="Right" Click="ShowAllTiles_Click"/>
            </DockPanel>
        </StackPanel>

        <Grid Grid.Row="1" Margin="0,0,0,12">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border x:Name="EfficiencyTileBorder" Grid.Column="0" Background="White" BorderBrush="#E3E3E3" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,12,0" DataContext="{Binding EfficiencyTile}">
                <StackPanel>
                    <DockPanel>
                        <TextBlock Text="Эффективность сети" FontWeight="SemiBold"/>
                        <Button Content="Скрыть" Style="{StaticResource TileLinkButtonStyle}" DockPanel.Dock="Right" Tag="EfficiencyTileBorder" Click="HideTile_Click"/>
                    </DockPanel>
                    <ProgressBar Height="18" Maximum="100" Value="{Binding EfficiencyPercent}" Margin="0,8,0,0"/>
                    <TextBlock Text="{Binding EfficiencyPercent, StringFormat={}{0}%}" FontSize="16" FontWeight="SemiBold" Margin="0,6,0,0"/>
                    <TextBlock Text="Работающих автоматов" FontSize="12" Foreground="Gray"/>
                </StackPanel>
            </Border>

            <Border x:Name="NetworkTileBorder" Grid.Column="1" Background="White" BorderBrush="#E3E3E3" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,12,0" DataContext="{Binding NetworkTile}">
                <StackPanel>
                    <DockPanel>
                        <TextBlock Text="Состояние сети" FontWeight="SemiBold"/>
                        <Button Content="Скрыть" Style="{StaticResource TileLinkButtonStyle}" DockPanel.Dock="Right" Tag="NetworkTileBorder" Click="HideTile_Click"/>
                    </DockPanel>
                    <WrapPanel Margin="0,8,0,0">
                        <Button Tag="Working" Click="NetworkStatus_Click" Padding="6,2" Margin="0,0,6,6">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Fill="#1FCB7A" Width="10" Height="10" Margin="0,0,6,0"/>
                                <TextBlock Text="Работает"/>
                            </StackPanel>
                        </Button>
                        <Button Tag="Offline" Click="NetworkStatus_Click" Padding="6,2" Margin="0,0,6,6">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Fill="#E74C3C" Width="10" Height="10" Margin="0,0,6,0"/>
                                <TextBlock Text="Не работает"/>
                            </StackPanel>
                        </Button>
                        <Button Tag="Service" Click="NetworkStatus_Click" Padding="6,2" Margin="0,0,6,6">
                            <StackPanel Orientation="Horizontal">
                                <Ellipse Fill="#F1C40F" Width="10" Height="10" Margin="0,0,6,0"/>
                                <TextBlock Text="Обслуживание"/>
                            </StackPanel>
                        </Button>
                    </WrapPanel>
                    <TextBlock Text="{Binding SelectedStatusText}" Foreground="Gray" Margin="0,4,0,0"/>
                    <StackPanel Margin="0,6,0,0">
                        <TextBlock Text="{Binding WorkingCount, StringFormat=Работает: {0}}"/>
                        <TextBlock Text="{Binding OfflineCount, StringFormat=Не работает: {0}}"/>
                        <TextBlock Text="{Binding ServiceCount, StringFormat=На обслуживании: {0}}"/>
                    </StackPanel>
                </StackPanel>
            </Border>

            <Border x:Name="SummaryTileBorder" Grid.Column="2" Background="White" BorderBrush="#E3E3E3" BorderThickness="1" CornerRadius="6" Padding="12" DataContext="{Binding SummaryTile}">
                <StackPanel>
                    <DockPanel>
                        <TextBlock Text="Сводка" FontWeight="SemiBold"/>
                        <Button Content="Скрыть" Style="{StaticResource TileLinkButtonStyle}" DockPanel.Dock="Right" Tag="SummaryTileBorder" Click="HideTile_Click"/>
                    </DockPanel>
                    <StackPanel Margin="0,8,0,0">
                        <TextBlock Text="{Binding SalesTotal, StringFormat=Продажи: {0:N0}}"/>
                        <TextBlock Text="{Binding CashTotal, StringFormat=Инкассация: {0:N0}}"/>
                        <TextBlock Text="{Binding MaintenanceTotal, StringFormat=Обслуживание: {0}}"/>
                    </StackPanel>
                </StackPanel>
            </Border>
        </Grid>

        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="2*"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <Border x:Name="SalesTileBorder" Grid.Column="0" Background="White" BorderBrush="#E3E3E3" BorderThickness="1" CornerRadius="6" Padding="12" Margin="0,0,12,0" DataContext="{Binding SalesTile}">
                <StackPanel>
                    <DockPanel>
                        <TextBlock Text="Динамика продаж за последние 10 дней" FontWeight="SemiBold"/>
                        <Button Content="Скрыть" Style="{StaticResource TileLinkButtonStyle}" DockPanel.Dock="Right" Tag="SalesTileBorder" Click="HideTile_Click"/>
                    </DockPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,8,0,8">
                        <Button Content="По сумме" Click="SalesFilterSum_Click" Margin="0,0,6,0"/>
                        <Button Content="По количеству" Click="SalesFilterCount_Click"/>
                    </StackPanel>
                    <ItemsControl ItemsSource="{Binding ChartItems}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Orientation="Horizontal"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Margin="4,0,4,0" VerticalAlignment="Bottom">
                                    <TextBlock Text="{Binding ValueText}" FontSize="10" HorizontalAlignment="Center"/>
                                    <Border Height="{Binding BarHeight}" Width="16" Background="#5DADE2" CornerRadius="2"/>
                                    <TextBlock Text="{Binding Day}" FontSize="10" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <Border x:Name="NewsTileBorder" Grid.Column="1" Background="White" BorderBrush="#E3E3E3" BorderThickness="1" CornerRadius="6" Padding="12" DataContext="{Binding NewsTile}">
                <StackPanel>
                    <DockPanel>
                        <TextBlock Text="Новости" FontWeight="SemiBold"/>
                        <Button Content="Скрыть" Style="{StaticResource TileLinkButtonStyle}" DockPanel.Dock="Right" Tag="NewsTileBorder" Click="HideTile_Click"/>
                    </DockPanel>
                    <ItemsControl ItemsSource="{Binding NewsItems}" Margin="0,8,0,0">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <TextBlock Text="{Binding}" TextWrapping="Wrap" Margin="0,0,0,6"/>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</Page>
